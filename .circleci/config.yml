version: 2.1

parameters:
  environments-repo-chart-name:
    type: string
    default: "notifications-service"

workflows:
  maven_test_then_build:
    jobs:
      # - maven/test:
      #     executor:
      #       name: maven/default
      #       tag: '11.0'
      # - java-services/validate_helm_chart:
      #     helm-chart-path: ./charts/notifications-service
      #     requires:
      #       - maven/test
      #     filters:
      #       branches:
      #         ignore:
      #           - master
      #           - /^release-v.*/
      # - java-services/publish_release:
      #     ecr-repo: reece/notifications-service
      #     helm-chart-name: notifications-service
      #     helm-chart-path: ./charts/notifications-service
      #     requires:
      #       - maven/test
      #     filters:
      #       branches:
      #         only: master
      # - java-services/publish_hotfix:
      #     ecr-repo: reece/notifications-service
      #     helm-chart-name: notifications-service
      #     helm-chart-path: ./charts/notifications-service
      #     requires:
      #       - maven/test
      #     filters:
      #       branches:
      #         only: /^release-v.*/
      # - java-services/deploy_release_dev:
      #     environments-repo-chart-name: notifications-service
      #     requires:
      #       - java-services/publish_release
      #     filters:
      #       branches:
      #         only: master
      # - maven/test:
      #     name: test_coverage
      #     executor:
      #       name: maven/default
      #       tag: '11.0'
      #     command: clean test jacoco:report coveralls:report
      #     requires:
      #       - maven/test
      - sonar-cloud:
          context: SonarCloud
          # requires:
          #   - maven/test        

jobs:
  sonar-cloud:
    docker:
      - image: 'cimg/openjdk:16.0.2'
    steps:
      - checkout
      - run:
          name: Analyze on SonarCloud
          command: mvn verify sonar:sonar -Dsonar.projectKey=sanghung4_SonarCloudTestRepo

orbs:
  # java-services: morsco-reece/java-services@1.2.0
  maven: circleci/maven@1.2.0

