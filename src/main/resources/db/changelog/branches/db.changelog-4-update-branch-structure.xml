<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<databaseChangeLog
    logicalFilePath="classpath:changelog-branches-4.xml"
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd"
>
    <changeSet author="brian.wong@dialexa.com" id="updateBranchStructure">
        <preConditions>
            <columnExists tableName="branches" columnName="monday_hours" />
            <columnExists tableName="branches" columnName="tuesday_hours" />
            <columnExists tableName="branches" columnName="wednesday_hours" />
            <columnExists tableName="branches" columnName="thursday_hours" />
            <columnExists tableName="branches" columnName="friday_hours" />
            <columnExists tableName="branches" columnName="saturday_hours" />
            <columnExists tableName="branches" columnName="branch_manager" />
            <columnExists tableName="branches" columnName="branch_manager_phone" />
            <columnExists tableName="branches" columnName="branch_manager_email" />
            <not>
                <columnExists tableName="branches" columnName="acting_branch_manager" />
                <columnExists tableName="branches" columnName="acting_branch_manager_phone" />
                <columnExists tableName="branches" columnName="acting_branch_manager_email" />
                <columnExists tableName="branches" columnName="business_hours" />
            </not>
        </preConditions>
        <dropColumn tableName="branches">
            <column name="monday_hours" />
            <column name="tuesday_hours" />
            <column name="wednesday_hours" />
            <column name="thursday_hours" />
            <column name="friday_hours" />
            <column name="saturday_hours" />
            <column name="branch_manager" />
            <column name="branch_manager_phone" />
            <column name="branch_manager_email" />
        </dropColumn>
        <addColumn tableName="branches">
            <column name="acting_branch_manager" type="VARCHAR(265)" />
            <column name="acting_branch_manager_phone" type="VARCHAR(100)" />
            <column name="acting_branch_manager_email" type="VARCHAR(265)" />
            <column name="business_hours" type="VARCHAR(1000)" />
        </addColumn>
        <rollback>
            <addColumn tableName="branches">
                <column name="monday_hours" type="VARCHAR(100)" />
                <column name="tuesday_hours" type="VARCHAR(100)" />
                <column name="wednesday_hours" type="VARCHAR(100)" />
                <column name="thursday_hours" type="VARCHAR(100)" />
                <column name="friday_hours" type="VARCHAR(100)" />
                <column name="saturday_hours" type="VARCHAR(100)" />
                <column name="branch_manager" type="VARCHAR(256)" />
                <column name="branch_manager_phone" type="VARCHAR(100)" />
                <column name="branch_manager_email" type="VARCHAR(256)" />
            </addColumn>
            <dropColumn tableName="branches">
                <column name="acting_branch_manager" />
                <column name="acting_branch_manager_phone" />
                <column name="acting_branch_manager_email" />
                <column name="business_hours" />
            </dropColumn>
        </rollback>
    </changeSet>
    <changeSet author="brian.wong@dialexa.com" id="tag-4-update-branch-structure">
        <tagDatabase tag="branches_v4" />
    </changeSet>
</databaseChangeLog>
