<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
        logicalFilePath="classpath:changelog-17.xml"
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
    <changeSet author="tim@dialexa.com" id="addPhoneTypes">
        <preConditions onFail="MARK_RAN" onFailMessage="Phone types already added">
            <sqlCheck expectedResult="0">select count(*) from phone_types where name = 'PHONE'</sqlCheck>
        </preConditions>
        <insert tableName="phone_types">
            <column name="name" value="MOBILE" />
            <column name="display_name" value="Mobile" />
        </insert>
        <insert tableName="phone_types">
            <column name="name" value="HOME" />
            <column name="display_name" value="Home" />
        </insert>
        <insert tableName="phone_types">
            <column name="name" value="OFFICE" />
            <column name="display_name" value="Office" />
        </insert>
        <insert tableName="phone_types">
            <column name="name" value="FAX" />
            <column name="display_name" value="Fax" />
        </insert>
        <rollback>
            <delete tableName="phone_types">
                <where>name='MOBILE'</where>
            </delete>
            <delete tableName="phone_types">
                <where>name='HOME'</where>
            </delete>
            <delete tableName="phone_types">
                <where>name='OFFICE'</where>
            </delete>
            <delete tableName="phone_types">
                <where>name='FAX'</where>
            </delete>
        </rollback>
    </changeSet>
    <changeSet author="tim (generated)" id="1613053371410-1">
        <preConditions onFail="MARK_RAN" onFailMessage="Account requests already has phone type.">
            <not>
                <columnExists tableName="account_requests" columnName="phone_type_id" />
            </not>
        </preConditions>
        <addColumn tableName="account_requests">
            <column name="phone_type_id" type="uuid"/>
        </addColumn>
        <addColumn tableName="account_requests_aud">
            <column name="phone_type_id" type="uuid"/>
        </addColumn>
        <addForeignKeyConstraint
                baseColumnNames="phone_type_id"
                baseTableName="account_requests"
                constraintName="FK222wxq18ouqwros4oyqmhs08"
                deferrable="false"
                initiallyDeferred="false"
                referencedColumnNames="id"
                referencedTableName="phone_types"/>
        <rollback>
            <dropForeignKeyConstraint
                    baseTableName="account_requests"
                    constraintName="FK222wxq18ouqwros4oyqmhs08" />
            <dropColumn tableName="account_requests_aud" columnName="phone_type_id" />
            <dropColumn tableName="account_requests" columnName="phone_type_id" />
        </rollback>
    </changeSet>
    <changeSet author="bryan.clark@dialexa.com" id="v17-add-phone-types">
        <tagDatabase tag="v17"/>
    </changeSet>
</databaseChangeLog>
