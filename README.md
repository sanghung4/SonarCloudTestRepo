# Companion Portal

## **Table of Contents**

- [**Overview**](#overview)
  - [_Key Features_](#key-features)
  - [_Deployed Environments_](#deployed-environments)
  - [_Project Directory Structure_](#project-directory-structure)
    - [Summary](#summary)
    - [Diagram](#diagram)
- [**Setup**](#setup)
  - [_Starting the App_](#starting-the-app)
  - [_Useful Scripts_](#useful-scripts)
- [**Deployment Process**](#deployment-process)
  - [_Configuration_](#configuration)
  - [_Deploying to Development_](#deploying-to-development)
  - [_Deploying to Test_](#deploying-to-test)

---

## **Overview**

> For more details about the application, please watch the recorded [Knowledge Transfer](https://reeceusa.atlassian.net/wiki/spaces/WPA/pages/1678016544/Frontend+Developer+Knowledge+Transfer#:~:text=Mario%27s%20KT%2D20220706_110531%2DMeeting%20Recording.mp4) session.

### _Key Features_

- Metrics
- Mincron Count
- Pricing _(aka Special Pricing)_
- Count Status
-

### _Deployed Environments_

- [Development](https://wms-admin.reecedev.us/)
- [Test](https://wms-admin.test.ecomm.reecedev.us/)
- [Production](https://wms-admin.reece.com/) - _requires permission to access_

### _Project Directory Structure_

#### Summary

- `/codegen.yaml` - Configuration file used by [GraphQL Code Generator](https://www.graphql-code-generator.com/)
- `/tailwind.config.js` - Configuration file for tailwindcss, learn more [here](https://tailwindcss.com/docs/configuration).
- `/nginx`
  - `generate-env.sh` - Script that generates `public/configuration.js`
- `/public`
  - `configuration.js` - Gathers all of the environment variables.
- `/src`
  - `apolloClient.js` - Configures ApolloClient
  - `App.tsx` - Handles routing and Okta security
  - `index.tsx` - Injection point for providers
- `/src/components` - Directory for all shared components
- `/src/components/ExampleComponent` - Each component is given its own directory
  - `index.ts` - Bundles all imports
  - `types.ts` - Component specific types
  - `utils.ts` - Component specific utilities and constants
  - `ExampleComponent.tsx` - JSX and logic for component
  - `ExampleSubComponent.tsx` - JSX for sub component specific to its parent
- `/src/pages` - Directory for all screens and pages
- `/src/pages/ExamplePage` - Each page is given its own directory
  - `index.ts` - Bundles all imports
  - `types.ts` - Page specific types
  - `utils.ts` - Page specific utilities and constants
  - `ExamplePage.tsx` - JSX and logic for page
  - `ExamplePageSpecificComponent.tsx` - JSX for component that is only used in that page
- `/src/graphql` - Directory for all GraphQL schemas and types
  - `index.ts` - File generated by [GraphQL Code Generator](https://www.graphql-code-generator.com/) that contains all schema types and Apollo query and mutation hooks.
  - `mutations.graphql` - Schema for mutation operations
  - `queries.graphql` - Schema for query operations

#### Diagram

```
🗂 wms-admin-portal
...
├──🗂 nginx
│  └──🛠 generate-env.sh
...
├──🗂 public
│  ...
│  └──🛠 configuration.js
...
├──🗂 src
│  ...
│  ├──🗂 components
│  │  ...
│  │  └──🗂 ExampleComponent
│  │     ├──📎 index.ts
│  │     ├──🔗 types.ts
│  │     ├──🛠 utils.ts
│  │     ├──📝 ExampleComponent.tsx
│  │     └──📝 ExampleSubComponent.tsx
│  ...
│  ├──🗂 pages
│  │  ...
│  │  └──🗂 ExamplePage
│  │     ├──📎 index.ts
│  │     ├──🔗 types.ts
│  │     ├──🛠 utils.ts
│  │     ├──📝 ExamplePage.tsx
│  │     └──📝 ExamplePageSpecificComponent.tsx
│  ...
│  ├──🗂 graphql
│  │  ├──🔗 index.ts
│  │  ├──📐 mutations.graphql
│  │  └──📐 queries.graphql
│  ...
│  ├──🛠 apolloClient.js
│  ├──📝 App.tsx
│  └──🛠 index.tsx
...
├──🛠 codegen.yml
└──🛠 tailwind.config.js
```

---

## **Setup**

> _Local .env files are not utilized in this project. Any environment specific configurations are handled by the build pipeline. More on this can be found in the [Deployment Process](#deployment-process) section._

### _Starting the App_

Before starting ensure that there is a `configuration.js` file in the `/public` directory. If there is not, create one containing the snippet below with all of the values defined:

```js
window.__configuration__ = {
  REACT_APP_OKTA_URL: [DEFINE VALUE],
  REACT_APP_OKTA_CALLBACK: [DEFINE VALUE],
  REACT_APP_OKTA_CLIENT_ID: [DEFINE VALUE],
  REACT_APP_OKTA_SCOPES: [DEFINE VALUE],
  REACT_APP_API_URL: [DEFINE VALUE],
  profile: [DEFINE VALUE],
  email: [DEFINE VALUE],
};
```

After the configuration file is created:

1. Install dependencies with `npm install`
2. Start the app with `npm start` [http://localhost:3000](http://localhost:3000)

### _GraphQL Code Generator_

[GraphQL Code Generator](https://www.graphql-code-generator.com/) is used in this project to generate types and hooks for GraphQL queries and mutations.

### _Useful Scripts_

- `npm test`
  - Runs Jest unit tests (not currently implemented)
- `npm run generate`
  - Utilizes The Guild's [GraphQL Code Generator](https://www.graphql-code-generator.com/)
  - Configured by `codegen.yml` in the project's root directory.
  - Uses the GraphQL schema, creates types, and generates hooks for Apollo queries and mutations.

---

## **Deployment Process**

### _Configuration_

Instead of using local `.env` files to configure the different environments, a script was added that generates a `configuration.js` tailored to each environment. For local development, use the `configuration.js` file like a `.env` to control different environment variables.

### _Deploying to Development_

Deployments to the **_Development Environment_** are handled by `reecebot` and only requires a merge into the `master` branch. After each merge, a tagged release is generated and can be found in the [Releases](https://github.com/morsco-reece/wms-admin-portal/releases) section of the repository.

### _Deploying to Test_

To deploy a new version of the application to the **_Test Environment_**, follow the following steps:

1. Clone the [`morsco-reece/environments`](https://github.com/morsco-reece/environments) repository, and create a new branch with a descriptive name.
2. In [`ecomm-test/Chart.yaml`](https://github.com/morsco-reece/environments/blob/master/ecomm-dev/Chart.yaml) under the dependency entry named "_wms-admin-portal_", change the value of the `version` parameter to match the version number of the tagged `wms-admin-portal` release that you want to deploy.

   - Where to change:
     ```yaml
     ...
     dependencies:
     ......
       - name: wms-admin-portal
         version: "0.56.0" # CHANGE THE VERSION NUMBER HERE
         repository: "@reece-ecomm"
     .....
     ...
     ```

3. Create a PR with a description of the changes made.
4. After the PR has been approved and _Squash Merged_, the CI/CD will be kicked off and can be tracked in the [CircleCI Dashboard](https://app.circleci.com/pipelines/github/morsco-reece).

---

Project was bootstrapped with [Create React App](https://github.com/facebook/create-react-app).

------
